# Quiz-App
socket.ioを使用したリアルタイム同期のクイズWebアプリ

---
## 環境構築手順

### 1. 必要なツールのインストール
- Node.js（v18以上）：LTS推奨
- SQL Server（2019以上）：Developer版
- Git（最新）：バージョン管理、ソースコード取得に使用
- SSMS（最新）：データベース管理GUI

### 2. ソースコードの取得
```
git clone https://github.com/ytanaka-ittera/Quiz-App.git
cd Quiz-App
```

### 3. Node.jsパッケージのインストール
```
npm install
```

### 4. データベースの準備

#### 4.1. 接続設定
```
1. SSMSを起動しlocalhostに接続
2. オブジェクトエクスプローラー > localhost(SQL Server xxx)で右クリック > プロパティ > セキュリティ > サーバー認証 「SQL Server 認証モードと Windows認証モード」を選択し「OK」
3. オブジェクトエクスプローラー > localhost(SQL Server xxx) > セキュリティ > ログイン > sa で右クリック > プロパティ
3-1. 全般 > パスワードを"sa"に設定、「パスワードポリシーを適用する」のチェックをOFF
3-2. 状態 > ログイン「有効」を選択し「OK」
4. localhost(SQL Server xxx)で右クリック > 再起動
```

#### 4.2. 作成バッチ実行
データベース作成、テーブル作成、初期データ登録を行うバッチ`setup_db.bat`を実行<br>
※初期データの内容を変更する場合、insert_data.sqlを修正してからバッチを実行してください。<br>
なおdatabase配下のファイルはすべてShift JISで作成されています。<br>
VSCodeで文字化けする場合、文字コードを変更してください。

### 5. アプリケーションの起動
```
node server.js
```

### 6. 各画面のURL
- ユーザー画面（ログイン画面）：http://localhost:3000/
- 管理者画面：http://localhost:3000/admin/
- モニター画面：http://localhost:3000/monitor/

---
## 操作方法

### 1. 管理者画面
画面表示時、DBに登録された問題一覧を表示します。<br>
問題一覧で選択した問題をモニター画面、ユーザー画面へ送信します。

- 問題文表示：モニター画面に問題文を表示します。ユーザー画面には表示しません。
- 選択肢表示：モニター画面に選択肢を表示します。ユーザー画面には表示しません。
- ユーザー画面に表示：ユーザー画面に問題文・選択肢を表示します。またカウントダウンも開始します。
- 解答表示：ユーザー画面、モニター画面に正解を表示します。
- 画面初期化：ユーザー画面、モニター画面を初期化します。
- スクリーン注目：ユーザー画面に「スクリーンをご覧ください」モーダルダイアログを表示します。
- スクリーン注目解除：スクリーン注目モーダルダイアログを表示解除します。
- ランキング画面へ：ランキング画面（ http://localhost:3000/ranking/ ）へ遷移します。

### 2. ランキング画面
ここまでの回答を元にランキングを表示します。<br>
モニター画面へ結果を送信し上位5チームを発表します。

- 結果発表準備：モニター画面にランキング表を表示します。なお順位の詳細（チーム名など）は非表示状態となります。
- ランキング表示：ランキング画面で選択した順位の詳細をモニター画面で表示状態にします。
- 画面初期化：ユーザー画面、モニター画面を初期化します。
- スクリーン注目：ユーザー画面に「スクリーンをご覧ください」モーダルダイアログを表示します。
- スクリーン注目解除：スクリーン注目モーダルダイアログを表示解除します。
- メイン画面へ：管理者画面（ http://localhost:3000/admin/ ） へ遷移します。

### 3. ユーザー画面
ユーザーに問題を表示し回答を送信します。<br>
事前にDBにユーザー名の登録が必要です。

- ログイン：DBに登録されているユーザー名を入力しログインすることで、対象ユーザーとして回答が可能となります。
- ログアウト：ログアウトしログイン画面へ遷移します。
- 各選択肢ボタン：表示された問題に対して回答を送信しDBに保存します。

### 4. モニター画面
スクリーンなどに表示するための画面です。<br>
この画面からの回答はできません。

---
## その他
### 1. SQL Serverに接続できずログインできない場合
SQL Server構成マネージャーより以下を確認してください。
1. SQL Serverが起動しているか
   - SQL Serverのサービス > サービスの種類：SQL Serverが実行中か
   - 実行中ではない場合、右クリック > 開始
2. TCP/IP プロトコルが有効になっているか
   - SQL Server ネットワークの構成 > インスタンス選択（例：MSSQLSERVER のプロトコル） > TCP/IP が有効になっているか
   - 有効になっていない場合、右クリック > 有効にする
3. SQL Serverのポートが「1433」となっているか
   - SQL Server ネットワークの構成 > インスタンス選択（例：MSSQLSERVER のプロトコル） > TCP/IPを右クリック > プロパティ > IPアドレス > IPALLのTCPポートが「1433」になっているか
   - なっていない場合、TCPポートを「1433」に変更、またはserver.jsのconfig > port をTCPポートの番号に変更する
